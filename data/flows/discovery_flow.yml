version: "3.1"

flows:
  recipe_discovery:
    description: Guia o utilizador através de filtros para encontrar receitas.
    name: Receita por Preferências
    steps:
      - collect: recipe_category
        description: "Tipo de prato desejado"
        
      - collect: cook_time
        description: "Tempo disponível para cozinhar"

      - collect: difficulty
        description: "Nível de dificuldade preferido"

      - collect: dietary_restrictions
        description: "Restrições alimentares"
        next:
          - if: slots.dietary_restrictions == "outro"
            then:
              - collect: avoid_ingredients
                description: "Ingredientes a evitar"
                next: collect_caloric
          - else: collect_caloric
        
      - id: collect_caloric 
        collect: caloric_preference
        description: "Preferência calórica"
        next: final_search
        
      - id: final_search 
        action: action_search_recipes
        next: show_results

      - id: show_results
        action: utter_ask_selected_recipe_number
        next: select_recipe_step

      - id: select_recipe_step
        collect: selected_recipe_number
        description: "Número da receita escolhida"
        next: show_recipe_details

      - id: show_recipe_details
        action: action_show_recipe_details
        next: ask_start_cooking_pref # <-- MUDANÇA: Continuação direta

      # --- LÓGICA DE INÍCIO DE COZINHA (MERGED) ---
      - id: ask_start_cooking_pref
        collect: cooking_choice
        description: "Escolha do utilizador para começar a cozinhar"
        next:
          - if: slots.cooking_choice == "começar"
            then: start_cooking_pref
          - if: slots.cooking_choice == "ver_outra"
            then: final_search # Volta à pesquisa
          - else: end_flow_pref

      - id: start_cooking_pref
        action: action_start_cooking_mode
        next: show_first_step_pref

      - id: show_first_step_pref
        action: action_next_step
        next: display_step_pref

      - id: display_step_pref
        action: action_show_current_step
        next: END

      - id: end_flow_pref
        action: utter_goodbye
        next: END